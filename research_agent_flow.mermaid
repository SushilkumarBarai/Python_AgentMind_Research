graph TD
    Start([ğŸš€ Start Application]) --> LoadEnv[âš™ï¸ Load Environment Variables]
    LoadEnv --> InitLLM[ğŸ¤– Initialize Claude LLM<br/>model: claude-3-5-sonnet]
    InitLLM --> InitParser[ğŸ“‹ Initialize Pydantic Parser<br/>ResearchResponse Schema]
    InitParser --> InitPrompt[ğŸ’¬ Create Chat Prompt Template<br/>System + Human + Scratchpad]
    InitPrompt --> InitTools[ğŸ› ï¸ Initialize 8 Tools<br/>search, wiki, calculator, etc.]
    
    InitTools --> CreateAgent[ğŸ”§ Create Tool Calling Agent]
    CreateAgent --> CreateExecutor[âš¡ Create Agent Executor<br/>max_iterations: 10]
    CreateExecutor --> DisplayMenu[ğŸ“º Display Welcome Menu<br/>Show Available Capabilities]
    
    DisplayMenu --> GetInput{ğŸ“ Get User Query}
    GetInput -->|Empty Query| ErrorMsg[âŒ Show Error:<br/>Invalid Query]
    ErrorMsg --> End([ğŸ End])
    
    GetInput -->|Valid Query| StartResearch[ğŸ” Start Research Process]
    StartResearch --> InvokeAgent[âš¡ Invoke Agent Executor]
    
    InvokeAgent --> AgentThinking{ğŸ§  Agent Analyzes Query}
    
    AgentThinking --> SelectTool{ğŸ¯ Select Appropriate Tool}
    
    SelectTool -->|Numbers/Math| CalcTool[ğŸ§® Calculator Tool<br/>Evaluate Expression]
    SelectTool -->|Web Info| SearchTool[ğŸ” Search Tool<br/>DuckDuckGo Search]
    SelectTool -->|Facts/History| WikiTool[ğŸ“š Wikipedia Tool<br/>Encyclopedia Lookup]
    SelectTool -->|Specific URL| ScraperTool[ğŸŒ Web Scraper<br/>Extract Content]
    SelectTool -->|Data File| DataTool[ğŸ“Š Data Analysis<br/>CSV/JSON Analysis]
    SelectTool -->|Date/Time| DateTool[ğŸ“… DateTime Tool<br/>Current Time Info]
    SelectTool -->|Read File| FileTool[ğŸ“„ File Reader<br/>Read Local File]
    SelectTool -->|Save Output| SaveTool[ğŸ’¾ Save Tool<br/>Write to File]
    
    CalcTool --> ToolResult[ğŸ“¤ Tool Returns Result]
    SearchTool --> ToolResult
    WikiTool --> ToolResult
    ScraperTool --> ToolResult
    DataTool --> ToolResult
    DateTool --> ToolResult
    FileTool --> ToolResult
    SaveTool --> ToolResult
    
    ToolResult --> CheckIterations{ğŸ”„ Check Iterations}
    CheckIterations -->|Need More Info| AgentThinking
    CheckIterations -->|Max Iterations| ForceOutput[âš ï¸ Force Output]
    CheckIterations -->|Complete| GenerateOutput[ğŸ“ Generate Structured Output]
    
    ForceOutput --> ParseResponse
    GenerateOutput --> ParseResponse{ğŸ” Parse Response}
    
    ParseResponse -->|Success| DisplayResults[ğŸ“Š Display Structured Results]
    ParseResponse -->|Parsing Error| DisplayRaw[âš ï¸ Display Raw Response<br/>Show Error Message]
    
    DisplayResults --> ShowTopic[ğŸ“Œ Show Topic]
    ShowTopic --> ShowSummary[ğŸ“ Show Summary]
    ShowSummary --> ShowFindings[ğŸ”‘ Show Key Findings]
    ShowFindings --> ShowSources[ğŸ”— Show Sources]
    ShowSources --> ShowTools[ğŸ› ï¸ Show Tools Used]
    
    ShowTools --> AskSave{ğŸ’¾ Ask User to Save?}
    DisplayRaw --> AskSaveFallback{ğŸ’¾ Ask User to Save?}
    
    AskSave -->|Yes| SaveResearch[ğŸ’¾ Save Research to File<br/>research_output.txt]
    AskSave -->|No| SkipSave[â­ï¸ Skip Saving]
    AskSaveFallback -->|Yes| SaveResearch
    AskSaveFallback -->|No| SkipSave
    
    SaveResearch --> Success[âœ… Show Success Message]
    SkipSave --> End
    Success --> End
    
    style Start fill:#90EE90
    style End fill:#FFB6C1
    style AgentThinking fill:#87CEEB
    style SelectTool fill:#DDA0DD
    style CalcTool fill:#F0E68C
    style SearchTool fill:#F0E68C
    style WikiTool fill:#F0E68C
    style ScraperTool fill:#F0E68C
    style DataTool fill:#F0E68C
    style DateTool fill:#F0E68C
    style FileTool fill:#F0E68C
    style SaveTool fill:#F0E68C
    style DisplayResults fill:#98FB98
    style ErrorMsg fill:#FFB6C1